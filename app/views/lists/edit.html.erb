<h1>Editar Lista: <%= @list.name %></h1>

<%= form_with(model: @list, local: true) do |form| %>
  <div class="field mb-3">
    <%= form.label :name, "Nome da Lista" %>
    <%= form.text_field :name, required: true, class: "form-control" %>
  </div>

  <div class="actions mb-4">
    <%= form.submit "Atualizar Lista", class: "btn btn-primary" %>
    <%= link_to 'Cancelar', @list, class: "btn btn-secondary" %>
  </div>
<% end %>

<hr class="my-4">

<h2>Compartilhar Lista</h2>

<%= form_with(url: share_list_path(@list), method: :post, local: true) do |form| %>
  <div class="row g-3 align-items-end">
    <div class="col-md-8">
      <%= label_tag :email, "Email do usuário para compartilhar:", class: "form-label" %>
      <%= text_field_tag :email, nil,
          placeholder: "exemplo@email.com",
          required: true,
          class: "form-control" %>
    </div>
    <div class="col-md-4">
      <%= submit_tag "Compartilhar", class: "btn btn-success w-100" %>
    </div>
  </div>
<% end %>

<h3 class="mt-4">Usuários com acesso</h3>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Email</th>
        <th>Tipo de Acesso</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr class="table-primary">
        <td><strong><%= @list.owner.email %></strong></td>
        <td><span class="badge bg-primary">Dono</span></td>
        <td>-</td>
      </tr>
      <% @list.shared_users.each do |user| %>
        <tr>
          <td><%= user.email %></td>
          <td><span class="badge bg-secondary">Compartilhado</span></td>
          <td>
            <%= button_to "Remover",
                unshare_list_path(@list, user_id: user.id),
                method: :delete,
                data: { confirm: "Remover acesso de #{user.email}?" },
                class: "btn btn-sm btn-danger" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div class="mt-3">
  <%= link_to "Voltar para Lista", @list, class: "btn btn-outline-secondary" %>
  <%= link_to "Voltar para Minhas Listas", lists_path, class: "btn btn-secondary" %>
</div>